<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cadastro</title>
  <!-- Semantic UI CDN -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" >
  <link rel="stylesheet" href="css/cadastro.css" >
</header>
<body>
  <body class="layout">
<header>
      <img src="imagens/GENERATION (1).svg" alt="Logo do Site" class="logo">
    </header>
</body>
  <main>
    <h1 class="ui header">Formulário de Cadastro</h1> 
    <form action="/cadastro" method="post" class="ui form" id="cadastro-form">
      
      
      <label for="nome">Nome Completo</label>
      <input
        type="text"
        id="nome"
        name="nome"
        value="<%= old.nome ? old.nome : '' %>"
        placeholder="Digite seu nome completo"
      />
      <% if (errors.nome) { %>
      <section class="ui pointing red basic label"><%= errors.nome.msg %></section>
      <% } %>

      <label for="email">E-mail</label>
      <input
        type="email"
        id="email"
        name="email"
        value="<%= old.email ? old.email : '' %>"
        placeholder="Digite seu e-mail"
      />
      <% if (errors.email) { %>
      <section class="ui pointing red basic label"><%= errors.email.msg %></section>
      <% } %>

      <label for="senha">Senha</label>
      <input
        type="password"
        id="senha"
        name="senha"
        placeholder="Digite sua senha"
      />
      <% if (errors.senha) { %>
      <section class="ui pointing red basic label"><%= errors.senha.msg %></section>
      <% } %>

      


      <label for="dataNascimento">Data de Nascimento</label>
      <input
      type="date"
      id="dataNascimento"
      name="dataNascimento"
      value="<%= old.dataNascimento ? old.dataNascimento : '' %>"
      placeholder="Selecione sua data de nascimento"
/>
<% if (errors.dataNascimento) { %>
<section class="ui pointing red basic label"><%= errors.dataNascimento.msg %></section>
<% } %>


     
      <p>
        <button type="submit" class="ui primary button">Cadastrar</button>
        <button type="reset" class="ui button">Limpar</button>
      </p>
     
    </form>
  </main>
<footer> 2025-Ecogeneration </footer>
  <script src="/js/validation.js"></script>
  <!-- Semantic UI JS CDN -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script> -->
  <script>
(function () {
  function removeFrontendError(input) {
    const next = input && input.nextElementSibling;
    if (next && next.classList && next.classList.contains('frontend')) {
      next.remove();
    }
  }

  function showError(input, message) {
    if (!input) return;
    removeFrontendError(input);
    if (!message) return;
    const errorLabel = document.createElement('section');
    errorLabel.className = 'ui pointing red basic label frontend';
    errorLabel.innerText = message;
    input.parentNode.insertBefore(errorLabel, input.nextElementSibling);
  }

  function validateNome() {
    const input = document.getElementById('nome');
    if (!input) return false;
    const v = input.value.trim();
    if (!v) {
      showError(input, 'Nome é obrigatório.');
      return false;
    }
    removeFrontendError(input);
    return true;
  }

  function validateEmail() {
    const input = document.getElementById('email');
    if (!input) return false;
    const v = input.value.trim();
    if (!v) {
      showError(input, 'E-mail é obrigatório.');
      return false;
    }
    const re = /^\S+@\S+\.\S+$/;
    if (!re.test(v)) {
      showError(input, 'E-mail inválido.');
      return false;
    }
    removeFrontendError(input);
    return true;
  }

  function validateSenha() {
    const input = document.getElementById('senha');
    if (!input) return false;
    const v = input.value.trim();
    if (!v) {
      showError(input, 'Senha é obrigatória.');
      return false;
    }
    if (v.length < 6) {
      showError(input, 'Senha deve ter no mínimo 6 caracteres.');
      return false;
    }
    removeFrontendError(input);
    return true;
  }

  function validateDataNascimento() {
    const input = document.getElementById('dataNascimento');
    if (!input) return false;
    const v = input.value;
    if (!v) {
      showError(input, 'Data de nascimento é obrigatória.');
      return false;
    }
    const inputDate = new Date(v);
    if (isNaN(inputDate.getTime())) {
      showError(input, 'Data inválida.');
      return false;
    }
    const today = new Date();
    inputDate.setHours(0,0,0,0);
    today.setHours(0,0,0,0);
    if (inputDate > today) {
      showError(input, 'Data de nascimento não pode ser no futuro.');
      return false;
    }
    removeFrontendError(input);
    return true;
  }

  function addListeners(id, fn) {
    const el = document.getElementById(id);
    if (!el) return;
    el.addEventListener('blur', fn);
    el.addEventListener('input', fn);
  }

  document.addEventListener('DOMContentLoaded', function () {
    addListeners('nome', validateNome);
    addListeners('email', validateEmail);
    addListeners('senha', validateSenha);
    addListeners('dataNascimento', validateDataNascimento);

    const cadastroForm = document.getElementById('cadastro-form');
    if (cadastroForm) {
      cadastroForm.addEventListener('submit', function (ev) {
        // remove avisos frontend antigos antes de validar
        document.querySelectorAll('.frontend').forEach(e => e.remove());

        // validação explícita — garante que campos vazios bloqueiem o redirecionamento
        const okNome = validateNome();
        const okEmail = validateEmail();
        const okSenha = validateSenha();
        const okData = validateDataNascimento();

        const allOk = okNome && okEmail && okSenha && okData;
        if (!allOk) {
          ev.preventDefault();
          // foca no primeiro campo inválido
          if (!okNome) document.getElementById('nome').focus();
          else if (!okEmail) document.getElementById('email').focus();
          else if (!okSenha) document.getElementById('senha').focus();
          else if (!okData) document.getElementById('dataNascimento').focus();
          return;
        }

        // todos válidos: impedir submit padrão e redirecionar para a página inicial
        ev.preventDefault();
        window.location.href = '/';
      });
    }

    const loginForm = document.getElementById('login-form');
    if (loginForm) {
      loginForm.addEventListener('submit', function (ev) {
        document.querySelectorAll('.frontend').forEach(e => e.remove());
        // valida somente email e senha do login
        const okEmail = validateEmail();
        const okSenha = validateSenha();
        if (!okEmail || !okSenha) ev.preventDefault();
        // se ok, permite envio ao servidor
      });
    }
  });
})();
  </script>
</body>
</html>
